感谢TVBoxOSC的开源

一直想给家里的老人用上智能设备，但是老人是文盲基本不会操作也记不住，所以一直在找方法，毕竟两个老人在老家很无聊，需要消遣时间。

之前也懒得去全新写一个app，发现了TVbox的开源后，大喜，可以在此基础上进行二次开发了。

于是大概花了半年时间，不断地修修补补和写一个远程控制的后端既可以后台添加视频源也可以修改控制设置，终于给家里的老人弄上了，不仅是电视，还有手机和平板都用上了。

记录一下功能情况，以免自己忘记有什么。

一、模式：

一般模式，Tvbox的原来模式盒子模式，专门给盒子使用，开机启动并且跳转到电视台手机模式，其实包含了两种小模式，一是抖音形式的上下划看视频，二是点选播放视频二、新直播以传统直播的形态，把直播和点播融合在一起，也就是说这个新直播的每一个台都有6个类型：   直连类：视频直接播放类型，比如MP4/M3U8/AVI， 视频直接播放链接或者直播流   解析类：顾名思义就是爱优腾等这些需要解析接口的网 址，遇到此类型可以直接调用后台接口（TVBOX的原本解析模式）   网页类：就是直接嗅探模式，嗅探网页中视频，和tvbox一样的嗅探规则，后台也可以修改设置的嗅探正则。   详情页：调用TVbox的详情页，  在新直播使用上了JAR的所有功能。   阿里云原画：与jar大神们写的原画不同，这里非常的狭隘，只能看自己的token和访问自己的账号的文件，唯一好的是这个原画视频是自己账号的，而且有限期为4小时。当然阿里云的也可以用 详情页模式，直接用小纸条云搜等jar。     播放页：其实是详情页的扩展，详情页中有很多个视频源组，有一些失效了或者只想挑选某一个高清源组，比如只选kuyun77中的ppayun的视频源，这样减少去请求详情页，达到秒播。

     

三、播放控制

老人不会操作这些，每一个视频都可以自定义设置好播放控制，比如片头片尾，播放进度，播放器，画面比例，播放超时自动跳转下一个源/或下一集等，如果是电视剧还可以设置第几集，进度控制，控制播放第几集，，如果是TV，那就是可以直接跳转播放，不用去调用详情页或者解析等等，就是普通的直播，TV模式不使用播放进度和

四、文件夹模式

      仅在手机端和平板端，类似alist的文件夹模式，UI和其他的视频一样，只是点击进去有一堆子视频，后面详细说。

五、缓存功能和远程下载

      此功能是为了以防家里断网后，或者老人需要把手机平板拿到没有WiFi的情况下看已下载的视频。缓存是边播边缓存。

远程下载是，可以在后台添加下载的视频链接，支持下载直接链接（mp4和m3u8），以及阿里云盘的视频下载（阿里云可以下载文件夹中指定视频）。

此外，远程下载可以下载任何文件，比如app文件，如果是app文件下载完毕后会自动调用安装功能，可以实现app更新和远程安装其他app。

下载功能也可以设置为 是下载到盒子还是手机。

另外远程下载功能，是自动判断后端有没有下载数据，有就进行自动下载全部的视频，开启下载时会有自定义语音提醒，下载完毕时也有提醒，全部下载好了也有语音提醒，这个语音提醒是我自己用方言录好了哈哈哈，因为老人不会普通话。

远程下载功能有断点下载，这次没有下载完，下次打开继续下载不用重新开始。

六、TVbox接口后台设置化

不用直接修改json代码，直接可视化操作增删改查，比如解析接口，比如爬虫站源等等。

七、天气预报和电视预告滚动文字

盒子端在播放页上面有三日的天气预报滚动文字和自定义文字功能，可以自己在后台设置和修改，比如我就是用来告知父母第一台有什么节目，有什么电视剧等。

滚动文字的展示时长可自定义控制。

八、启动图

就是小小心思吧，打开app的时候在加载jar和初始化的时间中展示，平时过年的时候用新年海报图，也可以是自己家的全家福，自由发挥，jpg png gif 都支持。

九、其他设置

*是否开启播放测速，老人不愿意折腾也不想麻烦孩子，所以平时就是电视播放源失效或者变卡了，也不愿意说，那么这个测速很有用，当卡的时候会自动推送到设置的邮箱。

*是否自动打开其他app，简单来说，就是盒子启动后会自动打开本app，然后本app会自动打开后台设置的app。这个功能是方便有时候打开其他app，比如远程控制软件？等等

*是否清理缓存，这里是全部清理缓存，比如封面图缓存 比如边看边缓存的文件，也可以指定清理。

*在连续剧页，是否控制播放，比如控制播放第几部连续剧。这里说一下，连续剧页是没有直播的，在非连续剧页面按键0可以直接跳转到连续剧页，也是打开即开始播放后台设置的连续剧，记录播放进度和播放到第几集，上下键变为上下集选择，频道+-为上下部选择。

十、进度记录

这个就是记录播放视频名称，播放集数，播放进度，播放时间，播放设备。就是为了查看播放记录，了解老人看了哪个。喜欢看什么。

十一、App新增剧

其实这个功能是给我用的，在一般模式中，搜索视频或者选择视频，进行片头片尾设置后，进行上传到后台，不用直接到后台复制粘贴。方便自己哈哈哈。

在app设置中可以选择一般模式，再选择高级，就有一般模式和上传按钮。

十二、设置页面需输入密码才能进入

以防小朋友打开了设置进行胡乱设置，所以加了一道防护。

十三、同步问题

在设置中，如果是盒子和手机模式，那么播放进度和播放集数以及播放情况都会同步上传到后端服务器，用于多个设备之间的同步，比如老人在电视上看了三体的第五集，播放到20分钟，那么他打开手机看三体的时候，也会接着播放第五集20分钟。

反之亦然。

同步会有两个问题是这样处理的：

服务器挂了，无法请求远程服务器的最新数据时，在此前每次打开app如果请求远程数据成功时，会保存一份数据到本地，遇到服务器无法访问时，就利用上次的本地数据。

家里的网络断了，可以直接看本地下载的视频，如果是手机平板端，会自动搜索本地所有的视频进行展示，以供选择播放，可配合缓存和远程下载功能，也可以下载好视频到手机储存中。

本地文件播放记录不同步到服务器，只记录播放情况，仅供查看

在设置中，也可以把同步关闭，这样自己测试的时候就不会更新同步信息，以免打乱了老人的播放记录。

十四、手机和平板端

后台可以设置为抖音模式的上下滑动刷视频，也可以设置为图片列表模式。因为在前期的时候老人不懂很多智能手机操作，抖音模式最简单，后来慢慢地懂了一些，于是开发了图片列表模式。

这个只有手机和平板端有，列表模式中有两个固定的文件夹，一个是边看边缓存的视频文件全部集合在此，另一个是本地储存中所有视频文件（不包括上面的app缓存文件和其他app缓存文件）。

此外，如果需要播放其他app缓存文件，也可以在后台新增，一条视频或者文件夹，链接写本地视频/文件夹的路径即可。

十五、解码配置

后台可以增删改查IJK播放器的解码配置。每一个视频每一个直播都可以单独选择某一个解码配置，比如电视台直播的我用专门自己调的直播配置，进行秒播。点播的用专门点播的，因为部分用直播的是秒播，但是非常卡顿。

十六、文件夹模式

前面有略涉及，专门给手机和平板用，用来分类，为什么用要和视频的UI一样？因为老人对于菜单和导航栏不理解，和视频ui一样是为了让他们更加清楚理解。

文件夹可以在后台以新增视频一样新增，只需要选择为文件夹模式，在新增视频时也可以把该视频归到指定文件夹中（填写文件夹名称即可）

文件夹有三种类型：

文件夹：此类是路径必须为手机本地路径

文件夹所有本地：app默认有了，有没有都可以

文件夹链接：就是以外部链接形式，点击该文件夹后，会去请求此链接进行文件夹内部视频数据填充，视频数据和其他视频数据格式一样。是套了一个层级。

文件夹可以有无限层级，可返回上级。

十七、交互

盒子端：大部分都是原版的交互，新直播模式的，上下键上下台，中间键为切换播放源，直播页的电视剧或者剧集的 频道+-键为上下集，也可以菜单键把播放控制菜单调出来，盒子端把返回键取消了，需要返回到一般模式，可以用菜单选择到首页。

0键 是切换页面，在直播页按下即可切换到连续剧页，连续剧页按下即可重新加载app，重新请求配置，然后跳转到设定的模式（比如盒子模式，一般模式，手机模式）

左右为快进和快退

数字键 在直播页可以直接选台，在电视剧页可以直接选集。

移动端：

点击视频即可播放，播放中单击即可快进30s，双击可以调出播放菜单，左右滑动可以快进快退，上下滑动可以调亮度和声音。

因为需要同步播放，所以每次点开播放后，如果退出到桌面，app自动关闭，打开就重新加载app，加载配置。

十八、解析模式优化

在遇到是解析的视频，我用了并发所有解析接口，先解析所有的json接口，解析到视频链接立即播放，并没有像tvbox一样就停止解析，而是保存到播放源中。

这样做是有一些解析接口可能挂了，或者不清晰或者有广告或者是几秒的广告视频，所以当遇到这些非正常解析视频，会有可选择，比如遇到垃圾接口解析出来的是10秒的广告视频，会自动屏蔽跳转到下一个源，这样就不会等待，无缝衔接播放。

最后说一下：

目前功能就这么多了，已经完全够用了哈哈哈，把自己想要的功能和父母需求全部搞定了， 也想不到什么需求了。

断断续续的在2022年二次开发和后台写了大概一年了，老人可以有看电视和看电视剧的自由了，特别喜欢追剧，也给他们上传了外地的孙子的小视频，和地方方言的戏曲，之前没有这些看，很无聊，现在经常拿手机平板看，可开心了。

仅仅是记录一下，也怕自己后面忘记了有什么功能。
